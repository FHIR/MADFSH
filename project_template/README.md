# MADFSH-Generated IG

This project was initialized using [MADFSH](https://github.com/FHIR/MADFSH). Update this section and any other details within this README to provide details on the IG.

## IG Viewing Quick Start

The rendered IG `output` directory is not under source control. To view the IG after checking out this project, either
1. unzip the `distribution/full-ig.zip` file and open the `index.html` file within the expanded `full-ig` directory, or
2. follow the 3rd step under the [Build process section](#build-process) and open the `igShortcut.html` file at the root of this project in a web browser.

## Contents and organization

This repository contains
- The source measure and MADFSH configuration data in the `madfsh-input` folder, which includes
  - meaures files, each encoded using the [FHIR-based eCQM representation format](https://hl7.org/fhir/us/cqfmeasures/StructureDefinition-executable-library-cqfm.html).
  - (optionally) a measure details JSON file based on the [**measureLinkFile** format](https://github.com/FHIR/MADFSH?tab=readme-ov-file#configuration-file-format) that is referenced from the **measureLinkFile** key in the `madfsh-config.json` configuration file.
  - (optionally) FHIR Bundles containing examples under the `examples` sub-folder.
- IG content generated by MADFSH in `input/fsh/profile.fsh` and `input/pagecontent/StructureDefinition*.md`
- Manually-created IG content and infrastructure in all other files and folders under the `input` folder.
- A [shortcut html file](igShortcut.html) for opening the rendered IG content.
- A distribution folder containing [package](distribution/package.tgz) and [full rendered ig](distribution/full-ig.zip) files for providing the rendered IG content ot others.

## Build process

This IG is built from measures using a semi-automated process, including

1. obtaining re-bundled versions of the FHIR-based measure bundles with more accurate data requirements using an [updated version](https://github.com/dczulada/clinical_quality_language/tree/handle_encouter_dx) of the [CQL support project](https://github.com/cqframework/clinical_quality_language). Instructions for running the updated tooling can be found [here](https://github.com/dczulada/clinical_quality_language/wiki). See the `madfsh-input` folder for the current set of converted measures.
2. run [`MADFSH`](https://github.com/FHIR/MADFSH) to generate IG content based on those measures. For this to work currently, you will need this repository and the MADFSH repository checked out to folders in the same root directory and then execute the following command from the `madfsh` directory: `ts-node src/app.ts -a "[ulm key]" -lu "[loinc username]" -lp "[loinc password]" -oidr -c <PROJECTROOT>/madfsh-config.json`
3. run the ig-publisher using the _madfsh_genonce script from the root project directory: e.g., on *nix system `sh ./_madfsh_genonce.sh`. Note that before you do this for the first time, you will need to run the `_updatePublisher` script. The `_madfsh` version copies ig distribution files into the `distribution` directory.

These steps will result in the IG content in the `output` directory with single-file packages to the `distribution` directory. Opening the `igShortcut.html` file at the root of this project will take out to the homepage of the generated IG, if present.

## Updating Measures

To add or update measures,
1. Add or update the measure files in the `madfsh-input` folder
2. If a measure detail file is present, update it with additional
   details on the measure, new or updated.
3. Add or update example Bundles.
3. Re-run the build process.